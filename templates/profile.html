{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<div class="container">

</br>
</br>
    <h2>My Profile</h2>

    <!-- Profile Update Form -->
    <form method="post" action="{% url 'update_profile' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="first_name">First Name:</label>
            <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user_info.first_name }}">
        </div>
        <div class="form-group">
            <label for="last_name">Last Name:</label>
            <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user_info.last_name }}">
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ user_info.email }}">
        </div>
        <button type="submit" class="btn btn-success">Update Profile</button>
    </form>

    <hr>

    <h3>Recent Purchases</h3>
    <form method="post" action="{% url 'add_to_cart' %}" id="cart-form">
        {% csrf_token %}
        <div class="row row-pb-md" id="product-container">
            {% for item in recent_purchases %}
            <div class="col-md-3 col-sm-6 mb-4 text-center">
                <div class="product-entry border product-card" data-product-id="{{ item.product_id }}">
                    
                    <!-- Info button linking to product detail -->
                    <a href="{% url 'product_detail' %}?product_id={{ item.product_id }}" class="btn btn-info mb-2">Info</a>
                    
                    <div class="product-selector">
                        <label for="product-{{ item.product_id }}">
    <input type="checkbox" name="selected_products" value="{{ item.product_id }}" id="product-{{ item.product_id }}" style="display:none;">
    <div class="prod-img">
        <img src="/products/{{ item.product_image_url|cut:'products/' }}" class="img-fluid" alt="{{ item.product_name }}">
    </div>
    <div class="desc">
        <h2>{{ item.product_name }}</h2>
        <span class="price">${{ item.product_price }}</span>
        <p>Purchased on {{ item.date_ordered|date:"M d, Y" }}</p>
    </div>
</label>
                    </div>
                </div>
            </div>
            {% empty %}
            <p>No best sellers available at the moment.</p>
            {% endfor %}
        </div>
        
        <!-- Add to Cart Button (outside the for loop) -->
        <div class="row">
            <div class="col-12 text-right">
                <button type="submit" class="btn btn-primary" id="add-to-cart-btn">
                    <i class="icon-shopping-cart"></i> Add to Cart (<span id="selected-count">0</span>)
                </button>
            </div>
        </div>
    </form>
</div>

</br>
</br>
{% endblock %}
